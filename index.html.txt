<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Âú∞Âç†ÈõôÁõ§Á≥ªÁµ± - Âç¶Ë±°‰øÆÊ≠£Áâà</title>
    <style>
        :root { --gold: #d4af37; --bg: #1a1a1a; --card: #262626; --text: #eee; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--gold); font-family: "Times New Roman", serif; margin: 0; padding: 10px; text-align: center; }
        .controls { background: var(--card); border: 1px solid #444; padding: 12px; border-radius: 8px; margin-bottom: 20px; max-width: 450px; margin: 0 auto; }
        .select-row { display: flex; justify-content: space-between; gap: 5px; margin-bottom: 10px; }
        select { background: #333; color: var(--gold); border: 1px solid var(--gold); border-radius: 4px; font-size: 11px; flex: 1; height: 32px; text-align: center; }
        button { background: var(--gold); color: #000; border: none; padding: 10px 15px; border-radius: 4px; font-weight: bold; font-size: 14px; width: 48%; cursor: pointer; }
        .shield-box { border: 2px solid var(--gold); background: var(--card); padding: 5px; max-width: 500px; margin: 0 auto; }
        .row-8 { display: flex; width: 100%; border-bottom: 1px solid #444; }
        .row-4 { display: flex; width: 100%; justify-content: space-around; padding-top: 10px; }
        .row-2 { display: flex; width: 100%; justify-content: space-around; padding-top: 15px; }
        .row-1 { display: flex; width: 100%; justify-content: center; padding-top: 15px; }
        .cell { flex: 1 1 0; min-width: 0; border: 0.5px solid #333; padding: 4px 0; display: flex; flex-direction: column; align-items: center; background: #1f1f1f; }
        .idx { font-size: 9px; color: #888; font-weight: bold; }
        .dots { font-size: 10px; line-height: 1.1; color: #f9d342; font-family: monospace; padding: 3px 0; }
        .name { font-size: 7px; color: #ccc; transform: scale(0.85); white-space: nowrap; margin-top: 2px; font-weight: bold; }
        .f15 { width: 85px; background: #333; clip-path: polygon(0 0, 100% 0, 50% 100%); padding-bottom: 18px; border: 1px solid var(--gold); }
        .reconciler-wrap { display: flex; justify-content: center; margin-top: 10px; padding-bottom: 5px; }
        .f16 { width: 90px; border: 1px dashed var(--gold); background: rgba(212, 175, 55, 0.05); border-radius: 10px; padding: 5px 0; position: relative; }
        .f16::before { content: "RECONCILER"; position: absolute; top: -8px; left: 50%; transform: translateX(-50%); background: var(--card); padding: 0 5px; font-size: 8px; color: var(--gold); opacity: 0.7; }
        .house-svg-container { width: 340px; height: 340px; margin: 20px auto; position: relative; }
        svg { width: 100%; height: 100%; }
        .line { stroke: var(--gold); stroke-width: 1.5; fill: none; }
        .h-idx { fill: var(--gold); font-size: 9px; font-weight: bold; opacity: 0.5; }
        .h-dots { fill: #f9d342; font-size: 10.5px; font-family: monospace; text-anchor: middle; }
        .h-name { fill: #fff; font-size: 6.5px; text-anchor: middle; font-weight: bold; }
        .h-meta { fill: var(--gold); font-size: 9px; font-weight: bold; }
        .footer { margin-top: 30px; padding: 20px 10px; border-top: 1px solid #333; font-size: 12px; color: #888; }
        .footer b { color: var(--gold); }
    </style>
</head>
<body>
    <h2>üìú Geomancy Ritual</h2>
    <div class="controls">
        <div class="select-row"><select id="m1_s"></select><select id="m2_s"></select><select id="m3_s"></select><select id="m4_s"></select></div>
        <button onclick="manualCast()">Ë®àÁÆóÈõôÁõ§</button>
        <button onclick="randomCast()" style="background:#444; color:#fff;">Èö®Ê©üËµ∑Âç¶</button>
    </div>
    <div class="shield-box">
        <div id="s_row1" class="row-8"></div><div id="s_row2" class="row-4"></div><div id="s_row3" class="row-2"></div><div id="s_row4" class="row-1"></div>
        <div id="s_row5" class="reconciler-wrap"></div>
    </div>
    <h3>üèõÔ∏è House Chart</h3>
    <div id="h_container" class="house-svg-container"></div>
    <div class="footer">Â¶ÇÊúâ‰ªª‰ΩïÂïèÈ°åËàáÊÑèË¶ãÂõûÈ•ãÔºåË´ãËàáÊàëËÅØÁπ´<br><b>instagram: grove_and_roots</b></div>

    <script>
        const figureList = [
            {name:"Via",code:"1111"}, {name:"Populus",code:"2222"},
            {name:"Conjunctio",code:"2112"}, {name:"Carcer",code:"1221"},
            {name:"Caput Draconis",code:"2111"}, {name:"Cauda",code:"1112"},
            {name:"Puella",code:"1211"}, // ‰øÆÊ≠£Ôºö1-2-1-1 (Áî±‰∏äËá≥‰∏ã)
            {name:"Puer",code:"1121"},   // ‰øÆÊ≠£Ôºö1-1-2-1 (Áî±‰∏äËá≥‰∏ã)
            {name:"Fortuna Major",code:"2211"}, {name:"Fortuna Minor",code:"1122"},
            {name:"Rubeus",code:"2122"}, {name:"Albus",code:"2212"},
            {name:"Acquisitio",code:"2121"}, {name:"Amissio",code:"1212"},
            {name:"Tristitia",code:"2221"}, {name:"Laetitia",code:"1222"}
        ];

        const figureNames = {}; 
        figureList.forEach(f => figureNames[f.code] = f.name);

        function add(f1, f2) { return f1.map((v, i) => v === f2[i] ? 2 : 1); }
        function renderDotsStr(fig) { return fig.map(v => v === 1 ? "‚óè" : "‚óè ‚óè"); }
        
        function createCell(fig, idx, className="") { 
            const code = fig.join(""); 
            const dots = renderDotsStr(fig).join("<br>"); 
            return `<div class="cell ${className}"><div class="idx">${idx}</div><div class="dots">${dots}</div><div class="name">${figureNames[code] || "Unknown"}</div></div>`; 
        }

        function runShield(m1, m2, m3, m4) {
            let d5=[m1[0],m2[0],m3[0],m4[0]], d6=[m1[1],m2[1],m3[1],m4[1]], d7=[m1[2],m2[2],m3[2],m4[2]], d8=[m1[3],m2[3],m3[3],m4[3]], 
                n9=add(m1,m2), n10=add(m3,m4), n11=add(d5,d6), n12=add(d7,d8), 
                w13=add(n9,n10), w14=add(n11,n12), j15=add(w13,w14), r16=add(m1,j15);
            const all = [null, m1, m2, m3, m4, d5, d6, d7, d8, n9, n10, n11, n12, w13, w14, j15, r16];
            document.getElementById("s_row1").innerHTML = [8,7,6,5,4,3,2,1].map(i => createCell(all[i], i)).join("");
            document.getElementById("s_row2").innerHTML = [12,11,10,9].map(i => createCell(all[i], i)).join("");
            document.getElementById("s_row3").innerHTML = [14,13].map(i => createCell(all[i], i)).join("");
            document.getElementById("s_row4").innerHTML = createCell(all[15], 15, "f15");
            document.getElementById("s_row5").innerHTML = createCell(all[16], 16, "f16");
            renderHouseSVG(all);
        }

        function renderHouseSVG(all) {
            const size = 320, mid = 160, iStart = 82, iEnd = 238;
            let tp = 0, sp = 0; 
            for (let i = 1; i <= 12; i++) { all[i].forEach(p => { tp += p; if (p === 1) sp += 1; }); }
            const pars = (tp % 12) || 12, idxP = (sp % 12) || 12;
            const centers = { 1:[52,160], 2:[42,242], 3:[78,281], 4:[160,275], 5:[242,281], 6:[272,242], 7:[268,160], 8:[272,72], 9:[242,39], 10:[160,45], 11:[78,39], 12:[48,72] };
            let svg = `<svg viewBox="0 0 ${size} ${size}"><rect x="5" y="5" width="310" height="310" class="line"/><polygon points="${mid},5 315,${mid} ${mid},315 5,${mid}" class="line"/><rect x="${iStart}" y="${iStart}" width="156" height="156" class="line"/><line x1="5" y1="5" x2="${iStart}" y2="${iStart}" class="line"/><line x1="315" y1="5" x2="${iEnd}" y2="${iStart}" class="line"/><line x1="5" y1="315" x2="${iStart}" y2="${iEnd}" class="line"/><line x1="315" y1="315" x2="${iEnd}" y2="${iEnd}" class="line"/><text x="${mid}" y="${mid-15}" fill="var(--gold)" font-size="12" text-anchor="middle" font-weight="bold">SOUL</text><text x="${mid}" y="${mid+8}" class="h-meta" text-anchor="middle">Á¶èÈªûÔºö${pars}</text><text x="${mid}" y="${mid+25}" class="h-meta" text-anchor="middle">indexÔºö${idxP}</text>`;
            for (let i = 1; i <= 12; i++) {
                const [cx, cy] = centers[i]; const dots = renderDotsStr(all[i]); const name = figureNames[all[i].join("")] || "Unknown"; let yOff = (i>=3&&i<=5)?-4:0;
                svg += `<g transform="translate(${cx}, ${cy+yOff})"><text x="-16" y="-18" class="h-idx" text-anchor="middle">${i}</text><g transform="translate(0, -4)"><text y="-10" class="h-dots">${dots[0]}</text><text y="0" class="h-dots">${dots[1]}</text><text y="10" class="h-dots">${dots[2]}</text><text y="20" class="h-dots">${dots[3]}</text></g><text y="33" class="h-name">${name}</text></g>`;
            }
            svg += `</svg>`; document.getElementById("h_container").innerHTML = svg;
        }

        function init() { 
            ['m1_s','m2_s','m3_s','m4_s'].forEach(id => { 
                const s = document.getElementById(id); s.innerHTML = "";
                figureList.slice().sort((a,b)=>a.name.localeCompare(b.name)).forEach(f => { 
                    let o=document.createElement('option'); o.value=f.code; o.text=f.name; s.appendChild(o); 
                }); 
            }); 
            randomCast(); 
        }
        window.manualCast = function() { 
            const getV = (id) => document.getElementById(id).value.split("").map(Number); 
            runShield(getV('m1_s'), getV('m2_s'), getV('m3_s'), getV('m4_s')); 
        };
        window.randomCast = function() { 
            const r = () => [1,1,1,1].map(() => Math.floor(Math.random()*2)+1); 
            const m1=r(), m2=r(), m3=r(), m4=r(); 
            document.getElementById('m1_s').value=m1.join(""); document.getElementById('m2_s').value=m2.join(""); 
            document.getElementById('m3_s').value=m3.join(""); document.getElementById('m4_s').value=m4.join(""); 
            runShield(m1, m2, m3, m4); 
        };
        init();
    </script>
</body>
</html>

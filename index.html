<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Geomantic Shield Chart - Pro</title>
    <style>
        body { background: #1a1a1a; color: #d4af37; text-align: center; font-family: "Times New Roman", serif; margin: 0; padding: 10px; overflow-x: hidden; }
        h2 { margin: 10px 0; letter-spacing: 2px; }
        
        /* æ§åˆ¶é¢æ¿ */
        .control-panel { background: #262626; border: 1px solid #444; padding: 15px; border-radius: 8px; margin-bottom: 20px; max-width: 600px; margin-left: auto; margin-right: auto; }
        .select-group { display: flex; justify-content: center; gap: 5px; margin: 10px 0; }
        select { background: #333; color: #d4af37; border: 1px solid #d4af37; padding: 5px; border-radius: 4px; font-size: 12px; width: 22%; }
        
        button { background: #d4af37; color: #1a1a1a; border: none; padding: 10px 15px; font-size: 14px; font-weight: bold; border-radius: 5px; cursor: pointer; margin: 5px; transition: 0.3s; }
        button:hover { background: #f9d342; }
        .btn-rand { background: #555; color: #eee; }

        /* ç›¾å‹ç›¤ä¸»å®¹å™¨ */
        .shield-container {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 2px;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            border: 2px solid #d4af37;
            padding: 5px;
            background: #262626;
            box-sizing: border-box;
        }

        /* å¦è±¡æ ¼å­ */
        .figure-card {
            border: 1px solid #444;
            padding: 5px 0;
            background: #1f1f1f;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 0;
        }

        .dots { font-size: 14px; line-height: 1.1; margin: 3px 0; color: #f9d342; font-family: monospace; }
        .name { font-size: 8px; font-weight: bold; color: #eee; white-space: nowrap; overflow: hidden; }
        .index { font-size: 9px; color: #888; border-bottom: 1px solid #444; width: 90%; margin-bottom: 2px; }

        /* --- ç›¾ç‰Œæ’ç‰ˆé‚è¼¯ --- */
        /* ç¬¬ä¸€å±¤ 1-8 (ç”±å³è‡³å·¦) */
        .f1 { grid-column: 8; grid-row: 1; }
        .f2 { grid-column: 7; grid-row: 1; }
        .f3 { grid-column: 6; grid-row: 1; }
        .f4 { grid-column: 5; grid-row: 1; }
        .f5 { grid-column: 4; grid-row: 1; }
        .f6 { grid-column: 3; grid-row: 1; }
        .f7 { grid-column: 2; grid-row: 1; }
        .f8 { grid-column: 1; grid-row: 1; }

        /* ç¬¬äºŒå±¤ 9-12 (è·¨å…©æ ¼) */
        .f9  { grid-column: 7 / span 2; grid-row: 2; margin-top: 10px; border-top: 1px solid #d4af37; }
        .f10 { grid-column: 5 / span 2; grid-row: 2; margin-top: 10px; border-top: 1px solid #d4af37; }
        .f11 { grid-column: 3 / span 2; grid-row: 2; margin-top: 10px; border-top: 1px solid #d4af37; }
        .f12 { grid-column: 1 / span 2; grid-row: 2; margin-top: 10px; border-top: 1px solid #d4af37; }

        /* ç¬¬ä¸‰å±¤ 13-14 (è·¨å››æ ¼) */
        .f13 { grid-column: 5 / span 4; grid-row: 3; margin-top: 15px; border-top: 1px solid #d4af37; }
        .f14 { grid-column: 1 / span 4; grid-row: 3; margin-top: 15px; border-top: 1px solid #d4af37; }

        /* ç¬¬å››å±¤ 15 (æ³•å®˜) */
        .f15 { 
            grid-column: 3 / span 4; grid-row: 4; 
            margin: 20px auto 10px; width: 100%;
            background: #333; border: 1px solid #d4af37;
            clip-path: polygon(0 0, 100% 0, 50% 100%);
            padding-bottom: 25px;
        }
    </style>
</head>
<body>

    <h2>ğŸ“œ Geomantic Shield</h2>

    <div class="control-panel">
        <div style="font-size: 13px; color: #aaa;">è«‹é¸æ“‡å››ä½æ¯è¦ªå¦ (Mothers 1-4)</div>
        <div class="select-group">
            <select id="m1_s"></select>
            <select id="m2_s"></select>
            <select id="m3_s"></select>
            <select id="m4_s"></select>
        </div>
        <button onclick="manualCast()">è¨ˆç®—ç›¾å‹ç›¤</button>
        <button class="btn-rand" onclick="randomCast()">éš¨æ©Ÿèµ·å¦</button>
    </div>

    <div id="shield" class="shield-container">
        </div>

    <script>
        // å®Œå…¨å°ç…§ç”¨æˆ¶åœ–è¡¨çš„åå–®
        const figureList = [
            {name: "Via", code: "1111"}, {name: "Populus", code: "2222"},
            {name: "Conjunctio", code: "2121"}, {name: "Carcer", code: "1212"},
            {name: "Caput Draconis", code: "1222"}, {name: "Cauda Draconis", code: "2111"},
            {name: "Puella", code: "1122"}, {name: "Puer", code: "2211"},
            {name: "Fortuna Major", code: "2112"}, {name: "Fortuna Minor", code: "1221"},
            {name: "Rubeus", code: "2122"}, {name: "Albus", code: "1211"},
            {name: "Acquisitio", code: "2212"}, {name: "Amissio", code: "1121"},
            {name: "Tristitia", code: "2221"}, {name: "Laetitia", code: "1112"}
        ];

        const figureNames = {};
        figureList.forEach(f => figureNames[f.code] = f.name);

        // åˆå§‹åŒ–é¸å–®
        function init() {
            const ids = ['m1_s', 'm2_s', 'm3_s', 'm4_s'];
            ids.forEach(id => {
                const s = document.getElementById(id);
                figureList.forEach(f => {
                    let o = document.createElement('option');
                    o.value = f.code; o.text = f.name;
                    s.appendChild(o);
                });
            });
        }

        // åœ°å åŠ æ³•é‚è¼¯ (1æ˜¯å¥‡, 2æ˜¯å¶)
        function add(f1, f2) { return f1.map((v, i) => v === f2[i] ? 2 : 1); }

        function renderDots(fig) { return fig.map(v => v === 1 ? "â—" : "â— â—").join("<br>"); }

        function makeHTML(fig, idx) {
            const code = fig.join("");
            return `<div class="figure-card f${idx}">
                <div class="index">${idx}</div>
                <div class="dots">${renderDots(fig)}</div>
                <div class="name">${figureNames[code] || code}</div>
            </div>`;
        }

        function runShield(m1, m2, m3, m4) {
            // ç”Ÿæˆ 5-8 å¥³å…’å¦ (å¾æ¯è¦ªå¦çš„æ©«åˆ—æå–)
            let d5 = [m1[0], m2[0], m3[0], m4[0]];
            let d6 = [m1[1], m2[1], m3[1], m4[1]];
            let d7 = [m1[2], m2[2], m3[2], m4[2]];
            let d8 = [m1[3], m2[3], m3[3], m4[3]];
            
            // éè¿´è¨ˆç®— 9-15
            let n9 = add(m1, m2); let n10 = add(m3, m4);
            let n11 = add(d5, d6); let n12 = add(d7, d8);
            let w13 = add(n9, n10); let w14 = add(n11, n12);
            let j15 = add(w13, w14);

            const all = [null, m1, m2, m3, m4, d5, d6, d7, d8, n9, n10, n11, n12, w13, w14, j15];
            let html = "";
            for(let i=1; i<=15; i++) { html += makeHTML(all[i], i); }
            document.getElementById("shield").innerHTML = html;
        }

        function manualCast() {
            const getV = (id) => document.getElementById(id).value.split("").map(Number);
            runShield(getV('m1_s'), getV('m2_s'), getV('m3_s'), getV('m4_s'));
        }

        function randomCast() {
            const r = () => [1,1,1,1].map(() => Math.floor(Math.random()*2)+1);
            const m1=r(), m2=r(), m3=r(), m4=r();
            // æ›´æ–°ä¸‹æ‹‰é¸å–®æ•¸å€¼åŒæ­¥é¡¯ç¤º
            document.getElementById('m1_s').value = m1.join("");
            document.getElementById('m2_s').value = m2.join("");
            document.getElementById('m3_s').value = m3.join("");
            document.getElementById('m4_s').value = m4.join("");
            runShield(m1, m2, m3, m4);
        }

        init();
    </script>
</body>
</html>
